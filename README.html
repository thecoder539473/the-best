const express = require("express");
const { createProxyMiddleware } = require("http-proxy-middleware");
const app = express();

app.use(express.urlencoded({ extended: true }));

// Front page
app.get("/", (req, res) => {
  res.send(`
    <html>
    <head>
      <title>Web Proxy</title>
      <style>
        body {
          background: black;
          color: #00ff00;
          font-family: monospace;
          display: flex;
          justify-content: center;
          align-items: center;
          height: 100vh;
        }
        .box {
          border: 2px solid #00ff00;
          padding: 30px;
          box-shadow: 0 0 20px #00ff00;
        }
        input, button {
          width: 100%;
          padding: 10px;
          margin-top: 10px;
          background: black;
          border: 1px solid #00ff00;
          color: #00ff00;
        }
        button:hover {
          background: #00ff00;
          color: black;
          cursor: pointer;
        }
      </style>
    </head>
    <body>
      <div class="box">
        <h2>WEB PROXY</h2>
        <form method="GET" action="/proxy">
          <input name="url" placeholder="https://example.com" required>
          <button>GO</button>
        </form>
      </div>
    </body>
    </html>
  `);
});

// Proxy route
app.use("/proxy", (req, res, next) => {
  const target = req.query.url;
  if (!target) return res.send("No URL provided");

  createProxyMiddleware({
    target,
    changeOrigin: true,
    secure: false,
    pathRewrite: { "^/proxy": "" },
    onProxyReq(proxyReq) {
      proxyReq.setHeader("User-Agent", "Mozilla/5.0");
    }
  })(req, res, next);
});

app.listen(3000, () => {
  console.log("ðŸ”¥ Web proxy running at http://localhost:3000");
});
